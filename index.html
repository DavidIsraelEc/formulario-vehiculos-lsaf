<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro Vehicular LSAF</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ============================================= */
/* ESTILOS GENERALES */
/* ============================================= */
* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background: linear-gradient(135deg, #0d2c46 0%, #1a4d79 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
.container { background-color: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); width: 100%; max-width: 750px; overflow: hidden; }
.header { background: linear-gradient(135deg, #0056b3 0%, #003a75 100%); color: white; padding: 25px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap; }
.logo-container { display: flex; align-items: center; }
.logo { width: 80px; height: 80px; border-radius: 50%; background-color: white; padding: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.2); }
.header-text { text-align: center; }
.header h1 { font-size: 32px; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1.5px; }
.header p { opacity: 0.9; font-size: 18px; }
.form-container { padding: 30px; }
.form-group { margin-bottom: 20px; }
label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; }
input, select { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; transition: all 0.3s; }
input:focus, select:focus { border-color: #0056b3; outline: none; box-shadow: 0 0 0 3px rgba(0,86,179,.2); }
.two-columns { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.required::after { content: " *"; color: #e74c3c; }
button { background: linear-gradient(135deg, #0056b3 0%, #003a75 100%); color: white; border: none; padding: 16px; font-size: 18px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: 600; transition: all 0.3s; margin-top: 10px; letter-spacing: 1px; text-transform: uppercase; position: relative; }
button:hover:not(:disabled) { background: linear-gradient(135deg, #004494 0%, #002954 100%); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
button:active:not(:disabled) { transform: translateY(0); }
button:disabled { background: linear-gradient(135deg,#6c757d 0%,#495057 100%); cursor: not-allowed; opacity: 0.8; }
.message { padding: 15px; margin: 20px 0; border-radius: 8px; display: none; text-align: center; font-weight: 500; }
.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.info-box { background-color: #e8f4ff; border-left: 4px solid #0056b3; padding: 15px; margin: 20px 0; border-radius: 4px; font-size: 14px; }
.loading-spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; margin-right: 10px; vertical-align: middle; }
@keyframes spin { to { transform: rotate(360deg); } }
.hidden { display: none; }
@media (max-width: 768px) { .two-columns { grid-template-columns: 1fr; } .form-container { padding: 20px; } .header { flex-direction: column; text-align: center; gap: 15px; } .header h1 { font-size: 26px; } }
</style>
</head>
<body>

<!-- ================= ACCESO ================= -->
<div id="accessSection" class="container">
  <h2><i class="fas fa-lock"></i> Sistema de Registro LSAF</h2>
  <p>Este formulario requiere un código de acceso válido</p>
  <input type="text" id="accessCode" placeholder="Ingresa el código de acceso" style="padding:12px;width:100%;margin:15px 0;font-size:16px;border-radius:6px;border:1px solid #ddd;">
  <button id="checkBtn"><i class="fas fa-unlock"></i> Verificar Acceso</button>
  <p id="accessError" class="error" style="display:none;"></p>
</div>

<!-- ================= FORMULARIO ================= -->
<div id="formContent" class="container hidden">
  <div class="header">
    <div class="logo-container">
      <img src="https://i.imgur.com/fHV1Qo1.png" alt="Logo LSAF" class="logo">
    </div>
    <div class="header-text">
      <h1>REGISTRO VEHICULAR LSAF</h1>
      <p>Sistema de Gestión Vehicular</p>
    </div>
  </div>

  <div class="form-container">
    <div class="info-box">
      <i class="fas fa-info-circle"></i> Complete todos los campos obligatorios (*) para registrar el vehículo en el sistema.
    </div>

    <div id="message" class="message"></div>

    <form id="vehicleForm">
      <div class="form-section">
        <div class="form-section-title">
          <i class="fas fa-user"></i> Información Personal
        </div>
        <div class="form-group">
          <label for="nombre" class="required">Nombre y Apellido</label>
          <input type="text" id="nombre" required placeholder="Ej: David Toro">
        </div>
        <div class="two-columns">
          <div class="form-group">
            <label for="nuim" class="required">NUIM</label>
            <input type="text" id="nuim" required placeholder="Ej: #ABCD">
          </div>
          <div class="form-group">
            <label for="telefono" class="required">Número de Teléfono</label>
            <input type="tel" id="telefono" required placeholder="Ej: 123456">
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-title">
          <i class="fas fa-car"></i> Información del Vehículo
        </div>
        <div class="two-columns">
          <div class="form-group">
            <label for="marca" class="required">Marca del Vehículo</label>
            <input type="text" id="marca" required placeholder="Ej: Gallivanter">
          </div>
          <div class="form-group">
            <label for="modelo" class="required">Modelo del Vehículo</label>
            <input type="text" id="modelo" required placeholder="Ej: Baller LE">
          </div>
        </div>
        <div class="two-columns">
          <div class="form-group">
            <label for="color" class="required">Color del Vehículo</label>
            <input type="text" id="color" required placeholder="Ej: Negro">
          </div>
          <div class="form-group">
            <label for="matricula" class="required">Matrícula del Vehículo</label>
            <input type="text" id="matricula" required placeholder="Ej: ABC-1234">
          </div>
        </div>
      </div>

      <button type="submit" id="submitBtn"><i class="fas fa-paper-plane"></i> Registrar Vehículo</button>
    </form>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwuZVRDOgShaXoDpfNKEG6UvO9FQ_Uh0ULlV9XOvntESC_hR0Xslz-yadDb-CkRolR_/exec"; // Pon aquí la URL de tu Web App
let ACTIVE_CODE = "";

// =================== ACCESO ===================
const accessCodeInput = document.getElementById("accessCode");
const checkBtn = document.getElementById("checkBtn");
const accessError = document.getElementById("accessError");
const accessSection = document.getElementById("accessSection");
const formContent = document.getElementById("formContent");

async function loadCurrentPassword() {
  try {
    const res = await fetch(SCRIPT_URL);
    const data = await res.json();
    ACTIVE_CODE = data.password;
  } catch (err) {
    console.error("Error obteniendo código:", err);
  }
}

async function checkAccess() {
  checkBtn.disabled = true;
  checkBtn.innerHTML = '<span class="loading-spinner"></span> Verificando...';
  await loadCurrentPassword();
  const code = accessCodeInput.value.trim();

  if (code === ACTIVE_CODE) {
    accessSection.classList.add("hidden");
    formContent.classList.remove("hidden");
  } else {
    accessError.textContent = "❌ Código incorrecto";
    accessError.style.display = "block";
    setTimeout(() => accessError.style.display = "none", 3000);
  }
  checkBtn.disabled = false;
  checkBtn.innerHTML = '<i class="fas fa-unlock"></i> Verificar Acceso';
}

checkBtn.addEventListener("click", checkAccess);
accessCodeInput.addEventListener("keypress", e => { if(e.key === 'Enter') checkAccess(); });

// =================== FORMULARIO ===================
const form = document.getElementById("vehicleForm");
const submitBtn = document.getElementById("submitBtn");
const messageDiv = document.getElementById("message");

form.addEventListener("submit", async e => {
  e.preventDefault();
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<span class="loading-spinner"></span> Enviando...';

  const formData = {
    nombre: document.getElementById("nombre").value,
    nuim: document.getElementById("nuim").value,
    telefono: document.getElementById("telefono").value,
    marca: document.getElementById("marca").value,
    modelo: document.getElementById("modelo").value,
    color: document.getElementById("color").value,
    matricula: document.getElementById("matricula").value
  };

  try {
    const res = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });
    const data = await res.json();
    if(data.status === "ok"){
      messageDiv.textContent = "✅ Vehículo registrado correctamente";
      messageDiv.className = "message success";
      form.reset();
    } else {
      throw new Error(data.message);
    }
  } catch(err) {
    console.error(err);
    messageDiv.textContent = "❌ Error al enviar los datos";
    messageDiv.className = "message error";
  }

  submitBtn.disabled = false;
  submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Registrar Vehículo';
});
</script>

</body>
</html>
