<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generador de Contraseñas - LSAF</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Mantener tu CSS original */
* {box-sizing: border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
body {background:linear-gradient(135deg,#1a4d79 0%,#0d2c46 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;}
.container {background-color:white;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.2);width:100%;max-width:500px;overflow:hidden;text-align:center;padding:30px;}
.logo {width:80px;height:80px;border-radius:50%;background-color:white;padding:10px;box-shadow:0 0 15px rgba(0,0,0,0.2);margin:0 auto 20px;}
h1 {color:#2c3e50;margin-bottom:10px;}
p {color:#666;margin-bottom:20px;}
.password-display {background:#f8f9fa;border:2px dashed #0056b3;border-radius:8px;padding:20px;margin:20px 0;font-size:24px;font-weight:bold;color:#0056b3;letter-spacing:2px;}
button {background:linear-gradient(135deg,#28a745 0%,#20c997 100%);color:white;border:none;padding:16px;font-size:18px;border-radius:8px;cursor:pointer;width:100%;font-weight:600;transition:all 0.3s;margin:10px 0;}
button:hover {background:linear-gradient(135deg,#218838 0%,#1e9e8a 100%);transform:translateY(-2px);}
.copy-btn {background:linear-gradient(135deg,#0056b3 0%,#003a75 100%);}
.message {padding:15px;margin:20px 0;border-radius:8px;display:none;}
.success {background-color:#d4edda;color:#155724;border:1px solid #c3e6cb;}
.error {background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
.info {background-color:#e8f4ff;color:#004085;border:1px solid #b8daff;}
.loading {display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s ease-in-out infinite;margin-right:10px;}
@keyframes spin {to {transform: rotate(360deg);}}
</style>
</head>
<body>
<div class="container">
<img src="https://i.imgur.com/fHV1Qo1.png" alt="Logo LSAF" class="logo">
<h1>Generador de Contraseñas LSAF</h1>
<p>Genera contraseñas para el sistema de registro vehicular</p>

<div class="password-display" id="passwordDisplay">
Presiona "Generar" para crear una contraseña
</div>

<button onclick="generatePassword()" id="generateBtn">
<i class="fas fa-key"></i> Generar Nueva Contraseña
</button>

<button class="copy-btn" onclick="copyPassword()" id="copyBtn">
<i class="fas fa-copy"></i> Copiar Contraseña
</button>

<div id="message" class="message"></div>
</div>

<script>
const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbwjC9OvoHQOqksobwRntn-5GP-DsWLyzIo3SciHVnS5VhirVcdc0iitVKfezUiqH8FO/exec'; // reemplaza por tu URL

let currentPassword = 'LSAF2025';

// Función para cargar contraseña actual usando JSONP
function loadPassword() {
    return new Promise(resolve => {
        const callbackName = 'cb' + Math.random().toString(36).substr(2,5);
        window[callbackName] = function(data) {
            delete window[callbackName];
            script.remove();
            if(data && data.password) { currentPassword = data.password; resolve(data.password); }
            else resolve(currentPassword);
        };
        const script = document.createElement('script');
        script.src = `${WEBAPP_URL}?action=getPassword&callback=${callbackName}`;
        document.body.appendChild(script);
    });
}

// Función para actualizar contraseña en el Sheet
function updatePassword(newPassword) {
    return new Promise((resolve,reject)=>{
        const callbackName = 'cb' + Math.random().toString(36).substr(2,5);
        window[callbackName] = function(data){
            delete window[callbackName];
            script.remove();
            if(data && data.success) resolve(data);
            else reject(new Error(data.error || 'Error al actualizar'));
        };
        const script = document.createElement('script');
        script.src = `${WEBAPP_URL}?action=updatePassword&password=${encodeURIComponent(newPassword)}&callback=${callbackName}`;
        script.onerror = ()=>{delete window[callbackName]; script.remove(); reject(new Error('Error de conexión'));}
        document.body.appendChild(script);
    });
}

async function generatePassword() {
    const btn = document.getElementById('generateBtn');
    const msg = document.getElementById('message');
    btn.innerHTML = '<span class="loading"></span> Generando...';
    btn.disabled = true;

    try {
        const num = Math.floor(Math.random()*10000).toString().padStart(4,'0');
        const newPassword = `LSAF${num}`;
        document.getElementById('passwordDisplay').textContent = newPassword;
        await updatePassword(newPassword);
        currentPassword = newPassword;
        msg.textContent = '¡Contraseña actualizada correctamente!';
        msg.className = 'message success';
        msg.style.display='block';
    } catch(e){
        msg.textContent = 'Error de conexión: '+e.message;
        msg.className='message error';
        msg.style.display='block';
        document.getElementById('passwordDisplay').textContent = currentPassword;
    } finally {
        btn.innerHTML='<i class="fas fa-key"></i> Generar Nueva Contraseña';
        btn.disabled=false;
    }
}

function copyPassword(){
    navigator.clipboard.writeText(currentPassword)
    .then(()=>{alert('Contraseña copiada: '+currentPassword);})
    .catch(()=>{alert('No se pudo copiar, usa Ctrl+C');});
}

window.onload = loadPassword;
</script>
</body>
</html>
